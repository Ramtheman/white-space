<div class="container mt-5">

    <% if @all_spaces == true %>
      <h2>Newly added spaces</h2>

      <%# TODO: Add modals to these %>

      <div class="row pb-5 mt-3">
        <% @spaces[0...2].each do |space| %>
          <div class="col-12 col-md-6">
          <%= link_to space_path(space), class: "list-link" do %>

            <div class="card-product grow">

              <% if space.photo.attached? %>
                <%= cl_image_tag space.photo.key, class: "image"%>
              <% else %>
                <%= image_tag "potato.jpg", class: "img" %>
              <% end %>
              <div class="card-product-infos">
                <h4><%= space.title %></h4>
                <p>Owner: <%= space.user.first_name %> <%= space.user.last_name %></p>
                <p>-------------------------</p>
                <p><%= space.space_type %></p>
                <p>£<%= space.price %>/day</p>
              </div>
            </div>
        <% end %>
      </div>
    <% end %>
  </div>

  <% end %>

  <div class="container mt-5" style="padding: 0px;">
    <h2>Search spaces</h2>
    <div id="SearchForm" >
    <div class="col-6" style="padding: 0px;">
      <%= form_tag spaces_path, method: :get do %>
        <%= text_field_tag :query,
          params[:query],
          class: "form-control",
          placeholder: "Find a space"
        %>
        <%= submit_tag "Search", class: "btn btn-primary" %>
        <% if @all_spaces == false %>
          <%= link_to "Back to All Spaces", spaces_path, class: 'btn btn-secondary' %>
        <% end %>
      <% end %>
    </div>
  </div>


  <h2><%= @all_spaces ? "" : "Search results" %></h2>

  <div class="row pb-5 mt-3">
      <% @spaces.each do |space| %>
        <div class="col-12 col-md-6">
        <%# <%= link_to space_path(space), class: "list-link" do %>
        <%= link_to space_path(space), class: "list-link", :id => 'example', "data-toggle" => "modal", 'data-target' => '#exampleModal' do %>
        <%# <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">Launch demo modal</button> %>

          <%# Card: %>
          <div class="card-product grow" id="example" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <% if space.photo.attached? %>
              <%= cl_image_tag space.photo.key, class: "image"%>
            <% else %>
              <%= image_tag "potato.jpg", class: "img" %>
            <% end %>
            <div class="card-product-infos">
              <h4><%= space.title %></h4>
              <p>Owner: <%= space.user.first_name %> <%= space.user.last_name %></p>
              <p>-------------------------</p>
              <p><%= space.space_type %></p>
              <p>£<%= space.price %>/day</p>
            </div>
          </div>

          <%# Modal: %>
          <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h2 class="modal-title" id="exampleModalLabel"><%= space.title %></h2>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                <%# MODAL CONTENTS %>

                <%# TODO: Stop the modal only showing the first space %>

                  <div class="container mt-5">
                    <div class="card-product">
                      <% if space.photo.attached? %>
                        <%= cl_image_tag space.photo.key, style:"height:250px"%>
                      <% else %>
                        <%= image_tag "potato.jpg", style:"height:250px" %>
                      <% end %>
                        <div class="card-product-infos">
                          <h2><%= space.title %></h2>
                          <p>Type of ad-space: <%= space.space_type %></p>
                          <p>Price: £<%= space.price %></p>
                          <p>Owner: <%= space.user.first_name %> <%= space.user.last_name %></p>
                        </div>
                    </div>
                  </div>
                <%# END OF MODAL CONTENTS %>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  <%= link_to 'Book', new_space_booking_path(space), class: 'btn btn-primary' %>
                </div>
              </div>
            </div>
          </div>
        </div>
        <% end %>

    <% end %>
  </div>

  <h3> Where you can find our spaces </h3>
  <div class="row pb-5 mt-3">
  <div style="width: 100%; height: 600px;"
       data-controller="mapbox"
       data-mapbox-markers-value="<%= @markers.to_json %>"
       data-mapbox-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
  </div>
  </div>
</div>
